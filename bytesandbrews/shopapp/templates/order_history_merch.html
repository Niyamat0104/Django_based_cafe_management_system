<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Order History</title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
   <style>
       /* Custom styling to match the provided template */
       header {
           background-color: var(--beige-medium);
           font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
           padding: 30px;
           font-size: 28px;
           font-weight: bold;
       }
   
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
           font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
       }
       
       body {
           background-color: #161a23;
           color: #ffffff;
       }

       .header {
           background: linear-gradient(90deg, var(--primary-blue), var(--secondary-blue));
           padding: 1rem 2rem;
           height: 100px;
           display: flex;
           align-items: center;
           justify-content: space-between;
           box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
       }

       .logo {
           font-size: 1.5rem;
           font-weight: bold;
           color: var(--beige-light);
           text-decoration: none;
           padding: 0.5rem 1rem;
           border: 2px solid var(--beige-light);
           border-radius: 8px;
           transition: all 0.3s ease;
       }

       .logo:hover {
           background: var(--beige-light);
           color: var(--primary-blue);
       }

       .nav-items {
           display: flex;
           align-items: center;
           gap: 1.5rem;
       }
       .nav-items a{
           font-size: 1.2rem;
       }

       .nav-link {
           color: var(--beige-light);
           text-decoration: none;
           font-size: 0.95rem;
           transition: color 0.3s ease;
           position: relative;
       }

       .nav-link:hover {
           color: var(--beige-medium);
       }

       .nav-link.active {
           color: var(--beige-medium);
           font-weight: 500;
       }

       .nav-link.active::after {
           content: '';
           position: absolute;
           bottom: -4px;
           left: 0;
           width: 100%;
           height: 2px;
           background-color: var(--beige-medium);
           border-radius: 2px;
       }

       .right-items {
           display: flex;
           align-items: center;
           gap: 1rem;
       }

       .icon-button {
           background: none;
           border: none;
           color: var(--beige-light);
           cursor: pointer;
           padding: 0.5rem;
           display: flex;
           align-items: center;
           justify-content: center;
           transition: color 0.3s ease;
       }

       .icon-button:hover {
           color: var(--beige-medium);
       }

       /* Icons */
       .icon {
           width: 20px;
           height: 20px;
       }

       .footer {
           background: var(--darker-blue);
           padding: 4rem 2rem 2rem;
           color: var(--beige-light);
       }

       .footer-content {
           max-width: 1400px;
           margin: 0 auto;
       }

       .footer-grid {
           display: grid;
           grid-template-columns: repeat(4, 1fr);
           gap: 2rem;
           margin-bottom: 3rem;
       }

       .footer-column {
           background: var(--box-blue);
           box-shadow: #040B24 0px 5px 15px;
           border-radius: 20px;
           padding: 2rem;
           height: fit-content;
       }

       .footer-column h3 {
           color: var(--beige-light);
           font-size: 1.25rem;
           
           font-weight: 500;
           margin-bottom: 1.5rem;
           padding-bottom: 0.75rem;
           border-bottom: 2px solid var(--accent-teal);
       }

       .footer-links {
           display: grid;
           gap: 0.75rem;
       }

       .footer-link {
           color: rgba(245, 232, 211, 0.7);
           text-decoration: none;
           font-size: 0.95rem;
           transition: color 0.3s ease;
       }

       .footer-link:hover {
           color: var(--beige-light);
       }

       .footer-bottom {
           display: flex;
           justify-content: space-between;
           align-items: center;
           padding-top: 2rem;
           border-top: 1px solid rgba(245, 232, 211, 0.1);
       }

       .company-info {
           display: flex;
           align-items: center;
           gap: 1rem;
           color: rgba(245, 232, 211, 0.7);
           font-size: 0.9rem;
       }

       .company-logo {
           font-weight: bold;
           color: var(--beige-light);
           text-decoration: none;
       }

       .social-links {
           display: flex;
           gap: 1.5rem;
       }

       .social-link {
           color: rgba(245, 232, 211, 0.7);
           text-decoration: none;
           transition: color 0.3s ease;
       }

       .social-link:hover {
           color: var(--beige-light);
       }

       .certification-badges {
           display: flex;
           gap: 1rem;
           margin-top: 2rem;
       }

       .certification-badge {
           background: rgba(245, 232, 211, 0.05);
           padding: 1rem;
           border-radius: 8px;
           width: 80px;
           height: 80px;
           display: flex;
           align-items: center;
           justify-content: center;
       }

       .certification-badge img {
           width: 100%;
           height: 100%;
           object-fit: contain;
       }

       @media (max-width: 1024px) {
           .footer-grid {
               grid-template-columns: repeat(2, 1fr);
           }
       }

       @media (max-width: 640px) {
           .footer-grid {
               grid-template-columns: 1fr;
           }
           
           .footer-bottom {
               flex-direction: column;
               gap: 1.5rem;
               text-align: center;
           }

           .company-info {
               flex-direction: column;
           }
       }

       @media (max-width: 768px) {
           .nav-items {
               display: none;
           }
           
           .header {
               padding: 1rem;
           }
       }

       .card {
           border-radius: 8px;
           box-shadow: 0 1px 3px rgba(0,0,0,0.05);
           border: 1px solid #eaeaea;
       }
       
       .progress {
           height: 4px;
           background-color: #f0f0f0;
           overflow: hidden;
       }
       
       .badge-success {
           background-color: #e6f7ef;
           color: #10b981;
           border: none;
           font-weight: normal;
           padding: 5px 10px;
           border-radius: 4px;
       }
       
       .badge-warning, .badge-danger {
           background-color: #fef3c7;
           color: #f59e0b;
           border: none;
           font-weight: normal;
           padding: 5px 10px;
           border-radius: 4px;
       }
       
       .badge-danger {
           background-color: #fee2e2;
           color: #ef4444;
       }
       
       .nav-pills .nav-link {
           color: #6b7280;
           padding: 0.5rem 1rem;
           border-radius: 4px;
       }
       
       .nav-pills .nav-link.active {
           background-color: #f3f4f6;
           color: #111827;
       }
       
       /* Main Table Styling */
       /* Container styling */
       .container-fluid {
           padding: 2rem;
       }

       /* Main Table Styling */
       .table {
           width: 100%;
           border-collapse: separate;
           border-spacing: 0;
           font-size: 16px;
           margin: 1.5rem 0;
           box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
           background-color: #ffffff;
           color: #1a365d; /* Dark blue text */
           border-radius: 6px;
           overflow: hidden;
           border: 1px solid #e2e8f0;
       }

       /* Table Header */
       .table thead th {
           background-color: #f8fafc;
           color: #1a365d;
           font-weight: 600;
           padding: 18px 15px;
           border-bottom: 2px solid #cbd5e1;
           text-align: left;
           vertical-align: middle;
           position: relative;
       }

       /* Sort icon spacing */
       .table thead th i {
           margin-left: 5px;
           color: #64748b;
       }

       /* Table Data Cells */
       .table tbody td {
           padding: 16px 15px;
           vertical-align: middle;
           border-bottom: 1px solid #e2e8f0;
       }

       /* Last row styling */
       .table tbody tr:last-child td {
           border-bottom: none;
       }

       /* Alternating Row Colors */
       .table tbody tr:nth-child(even) {
           background-color: #f8fafc;
       }

       /* Hover Effect */
       .table tbody tr:hover {
           background-color: #f1f5f9;
       }

       /* Checkbox Styling */
       .table input[type="checkbox"] {
           width: 20px;
           height: 20px;
           cursor: pointer;
           border: 2px solid #64748b;
           border-radius: 3px;
       }

       /* Button Styling */
       .btn {
           padding: 10px 16px;
           margin-right: 10px;
           border-radius: 6px;
           cursor: pointer;
           font-size: 14px;
           font-weight: 500;
           transition: all 0.2s ease;
           box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
       }

       .btn-sm {
           padding: 8px 12px;
       }

       .btn-edit {
           background-color: #e0f2fe;
           color: #0369a1;
           border: 1px solid #bae6fd;
       }

       .btn-delete {
           background-color: #fecdd3;
           color: #be123c;
           border: 1px solid #fda4af;
       }

       .btn-view {
           background-color: #dbeafe;
           color: #1e40af;
           border: 1px solid #93c5fd;
       }

       .btn-edit:hover {
           background-color: #bae6fd;
       }

       .btn-delete:hover {
           background-color: #fda4af;
       }

       .btn-view:hover {
           background-color: #93c5fd;
       }

       /* Icons in buttons */
       .btn i {
           margin-right: 6px;
       }

       /* Responsive container */
       .table-responsive {
           overflow-x: auto;
           -webkit-overflow-scrolling: touch;
           border-radius: 6px;
           margin: 0 1.5rem;
       }

       /* Status indicator */
       .status-badge {
           display: inline-block;
           padding: 5px 10px;
           border-radius: 4px;
           font-size: 12px;
           font-weight: 600;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }

       .status-badge.pending {
           background-color: #fef3c7;
           color: #92400e;
       }

       .status-badge.processing {
           background-color: #e0f2fe;
           color: #0369a1;
       }

       .status-badge.shipped {
           background-color: #dbeafe;
           color: #1e40af;
       }

       .status-badge.delivered {
           background-color: #dcfce7;
           color: #166534;
       }

       .status-badge.cancelled {
           background-color: #fee2e2;
           color: #b91c1c;
       }

       /* Monetary values styling */
       .table .price-cell {
           font-family: 'Courier New', monospace;
           text-align: right;
           font-weight: 600;
       }

       /* First column (checkbox column) */
       .table th:first-child,
       .table td:first-child {
           padding-left: 20px;
       }

       /* Last column (actions column) */
       .table th:last-child,
       .table td:last-child {
           padding-right: 20px;
       }

       /* Table header text styling */
       .table th {
           text-transform: uppercase;
           letter-spacing: 0.5px;
           font-size: 14px;
       }

       /* No results message */
       .no-results {
           padding: 2rem;
           text-align: center;
           color: #64748b;
           font-style: italic;
       }

       /* Page title */
       .page-title {
           color: #ffffff;
           margin: 2rem 0 1rem 2rem;
           font-size: 2rem;
           font-weight: 600;
       }

       /* Filter bar */
       .filter-bar {
           display: flex;
           justify-content: space-between;
           align-items: center;
           margin: 0 2rem 1rem;
           padding: 1rem;
           background-color: rgba(255, 255, 255, 0.1);
           border-radius: 8px;
       }

       .filter-bar .filters {
           display: flex;
           gap: 1rem;
       }

       .filter-bar select, .filter-bar input {
           padding: 0.5rem;
           border-radius: 4px;
           border: 1px solid #e2e8f0;
           background-color: #ffffff;
       }

       .filter-bar .btn-primary {
           background-color: #0369a1;
           color: white;
           border: none;
       }

       .filter-bar .btn-primary:hover {
           background-color: #0284c7;
       }
   </style>
</head>
<body>
   <header class="header">
       <a href="" class="logo">BYTES AND BREW</a>
       
       <nav class="nav-items">
           <a href="{% url 'order_app:admin' %}" class="nav-link">Home</a>
           {% if user.is_authenticated and user.is_staff and not user.is_superuser %}
           <a href="{% url 'order_app:dashboard' id=user.id %}" class="nav-link active">Dashboard</a>
           {% endif %}
           {% if user.is_authenticated and user.is_superuser %}
           <a href="{% url 'order_app:superadmin' %}" class="nav-link active">SUPERADMIN PANEL</a>
           {% endif %}
           
           <a href="{% url 'order_app:contact' %}" class="nav-link">CONTACT US</a>
           <a href="{% url 'order_app:about' %}" class="nav-link">ABOUT US</a>
           {% if user.is_authenticated %}
           <a href="{% url 'order_app:profile' id=user.id %}" class="nav-link">PROFILE </a>
           <a href="{% url 'order_app:logout' %}" class="nav-link active">LOGOUT</a>
           {% endif %}
       </nav>

       <div class="right-items">
           <a href="#"><i class="fa fa-user-o" style="font-size:36px;color: var(--beige-light);"></i></a>
       </div>
   </header>
   {% if messages %}
   {% for message in messages %}
   <div class="alert alert-warning alert-dismissible fade show" role="alert">
       {{message}}
       <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
   </div>
   {% endfor %}
   {% endif %}
   
   <h1 class="page-title">Order History</h1>
   
   
   
   <div class="container-fluid py-4">
       <div class="table-responsive">
           <table class="table">
               <thead>
                   <tr>
                       <th>
                           <input type="checkbox" class="select-all">
                       </th>
                       <th>Order #</th>
                       <th>Date <i class="fas fa-sort"></i></th>
                       <th>Items</th>
                       <th>Shipping To</th>
                       <th>Payment Method</th>
                       <th>Total</th>
                       <th>Status</th>
                       <th>Actions</th>
                   </tr>
               </thead>
              <!-- This is the section to replace in your order_history_merch.html template -->
<!-- Table rows part for displaying order items and subtotal correctly -->
<tbody>
    {% for order in orders %}
    <tr>
        <td>
            <input type="checkbox" class="select-item">
        </td>
        <td>{{ order.order_number }}</td>
        <td>{{ order.created_at|date:"M d, Y" }}</td>
        <td>
            <!-- Display item count correctly -->
            {{ order.items.count }} items
            <!-- Optional: Show item names in tooltip or expandable section -->
            <div class="item-tooltip d-none">
                {% for item in order.items.all %}
                <div>{{ item.quantity }}x {{ item.product_name }}</div>
                {% endfor %}
            </div>
        </td>
        <td>
            {% if order.shipping_address %}
            {{ order.shipping_address.city }}, {{ order.shipping_address.state }}
            {% else %}
            Not available
            {% endif %}
        </td>
        <td>
            {% if order.payment_method %}
            {{ order.payment_method.get_payment_type_display }}
            {% else %}
            UPI
            {% endif %}
        </td>
        <td class="price-cell">₹{{ order.total }}</td>
        <td>
            <span class="status-badge {{ order.status }}">
                {{ order.get_status_display }}
            </span>
        </td>
        <td>
            <a href="{% url 'shop_app:order_detail' order_number=order.order_number %}"> 
                <button class="btn btn-sm btn-view">
                    <i class="fas fa-eye"></i> View
                </button>
            </a>
            {% if order.status == 'pending' or order.status == 'processing' %}
            <a href="#" class="btn-cancel-order" data-order="{{ order.order_number }}"> 
                <button class="btn btn-sm btn-delete">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </a>
            {% endif %}
        </td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="9" class="no-results">No orders found</td>
    </tr>
    {% endfor %}
</tbody>
           </table>
       </div>
       
       <!-- Pagination -->
       {% if orders.has_other_pages %}
<div class="d-flex justify-content-center my-4">
    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% if orders.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ orders.previous_page_number }}{% if current_status and current_status != 'None' %}&status={{ current_status }}{% endif %}{% if search_query and search_query != 'None' %}&search={{ search_query }}{% endif %}{% if start_date and start_date != 'None' %}&start_date={{ start_date }}{% endif %}{% if end_date and end_date != 'None' %}&end_date={{ end_date }}{% endif %}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            {% endif %}
            
            {% for i in orders.paginator.page_range %}
                {% if orders.number == i %}
                <li class="page-item active"><a class="page-link" href="#">{{ i }}</a></li>
                {% else %}
                <li class="page-item"><a class="page-link" href="?page={{ i }}{% if current_status and current_status != 'None' %}&status={{ current_status }}{% endif %}{% if search_query and search_query != 'None' %}&search={{ search_query }}{% endif %}{% if start_date and start_date != 'None' %}&start_date={{ start_date }}{% endif %}{% if end_date and end_date != 'None' %}&end_date={{ end_date }}{% endif %}">{{ i }}</a></li>
                {% endif %}
            {% endfor %}
            
            {% if orders.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ orders.next_page_number }}{% if current_status and current_status != 'None' %}&status={{ current_status }}{% endif %}{% if search_query and search_query != 'None' %}&search={{ search_query }}{% endif %}{% if start_date and start_date != 'None' %}&start_date={{ start_date }}{% endif %}{% if end_date and end_date != 'None' %}&end_date={{ end_date }}{% endif %}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endif %}
   </div>

   <footer class="footer">
    <div class="footer-content">
        <div class="footer-grid">
            <div class="footer-column">
                <h3>Expertise</h3>
                <div class="footer-links">
                    <a href="#" class="footer-link">Analytics and Reporting</a>
                    <a href="#" class="footer-link">Inventory Management</a>
                    <a href="#" class="footer-link">Mobile and Remote Access</a>
                    <a href="#" class="footer-link">Endpoint Management</a>
                    <a href="#" class="footer-link">Order Processing</a>
                    <a href="#" class="footer-link">Customer Database</a>
                    <a href="#" class="footer-link">Integration Capabilities</a>
                    <a href="#" class="footer-link">Security and Compliance</a>
                    <a href="#" class="footer-link">Menu Management</a>
                    <a href="#" class="footer-link">Employee Management</a>
                </div>
            </div>

            <div class="footer-column">
                <h3>Company</h3>
                <div class="footer-links">
                    <a href="#" class="footer-link">About Us</a>
                    <a href="#" class="footer-link">News</a>
                    <a href="#" class="footer-link">Contact</a>
                    <a href="#" class="footer-link">Trust Centre</a>
                    <a href="#" class="footer-link">Terms of Service</a>
                    <a href="#" class="footer-link">Security Policy</a>
                    <a href="#" class="footer-link">Privacy Policy</a>
                </div>
            </div>

            <div class="footer-column">
                <h3>Targeted Industries</h3>
                <div class="footer-links">
                    <a href="#" class="footer-link">CAFES</a>
                    <a href="#" class="footer-link">RESORTS</a>
                    <a href="#" class="footer-link">CLOUD KITCHENS</a>
                    <a href="#" class="footer-link">BAKERIES</a>
                    <a href="#" class="footer-link">FOOD TRUCKS</a>
                    <a href="#" class="footer-link">CORPORTE CAFETERIAS</a>
                    <a href="#" class="footer-link">FAST FOOD CHAINS</a>
                </div>
            </div>

            <div class="footer-column">
                <h3>Learn & Support</h3>
                <div class="footer-links">
                    <a href="#" class="footer-link">Technical Insights</a>
                    <a href="#" class="footer-link">Events</a>
                    <a href="#" class="footer-link">BYTES AND BREWS</a>
                    <a href="#" class="footer-link">Client Support</a>
                </div>
                <div class="certification-badges">
                    <div class="certification-badge">
                        <i class="fa fa-bar-chart-o" style="font-size:48px;color:var(--beige-light)"></i>
                    </div>
                    <div class="certification-badge">
                         <img src="{% static 'images/bytesandbrewlogo-removebg-preview.png' %}" height="100px">
                    </div>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <div class="company-info">
                <a href="#" class="company-logo">Bytes and Brews Systems</a>
                <span>© 2025 All rights reserved.</span>
            </div>
            <div class="social-links">
                <i class="fa fa-facebook-f" style="font-size:25px;color:var(--beige-light)"></i>
                <i class="fa fa-instagram" style="font-size:25px;color:var(--beige-light)"></i>
                <i class="fa fa-linkedin" style="font-size:25px;color:var(--beige-light)"></i>
                <i class="fa fa-twitter" style="font-size:25px;color:var(--beige-light)"></i>
            </div>
        </div>
    </div>
</footer>
</body>
<script>
    
    document.addEventListener('DOMContentLoaded', function() {
        // Handle select all checkbox
        const selectAllCheckbox = document.querySelector('.select-all');
        if (selectAllCheckbox) {
            selectAllCheckbox.addEventListener('change', function() {
                const giftCardCheckboxes = document.querySelectorAll('tbody input[type="checkbox"]');
                giftCardCheckboxes.forEach(checkbox => {
                    checkbox.checked = selectAllCheckbox.checked;
                });
            });
        }
        
        // Status filter functionality
        const statusFilter = document.getElementById('status-filter');
        if (statusFilter) {
            statusFilter.addEventListener('change', function() {
                // In a real implementation, you would submit the form or use AJAX to filter
                const selectedStatus = statusFilter.value;
                console.log('Filtering by status:', selectedStatus);
            });
        }
        
        // Date filters
        const startDateFilter = document.getElementById('start-date');
        const endDateFilter = document.getElementById('end-date');
        
        if (startDateFilter && endDateFilter) {
            startDateFilter.addEventListener('change', applyDateFilter);
            endDateFilter.addEventListener('change', applyDateFilter);
        }
        
        function applyDateFilter() {
            // In a real implementation, you would submit the form or use AJAX to filter
            const startDate = startDateFilter.value;
            const endDate = endDateFilter.value;
            console.log('Date filter:', startDate, 'to', endDate);
        }
    });

    // Add this JavaScript to your template file
document.addEventListener('DOMContentLoaded', function() {
    // Get all cancel order buttons
    const cancelButtons = document.querySelectorAll('.btn-cancel-order');
    
    // Add click event listener to each cancel button
    cancelButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Get the order number from data attribute
            const orderNumber = this.getAttribute('data-order');
            
            // Confirm deletion
            if (confirm('Are you sure you want to delete this order? This action cannot be undone.')) {
                // Create form data
                const formData = new FormData();
                formData.append('order_number', orderNumber);
                
                // Get CSRF token from cookie
                const csrftoken = getCookie('csrftoken');
                
                // Send AJAX request
                fetch('{% url "shop_app:cancel_order" %}', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrftoken
                    },
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show success message
                        alert(data.message);
                        
                        // Reload the page to update the order list
                        window.location.reload();
                    } else {
                        // Show error message
                        alert(data.message || 'Failed to delete the order.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the order.');
                });
            }
        });
    });
    
    // Function to get CSRF token from cookies
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});
 </script>
</html>